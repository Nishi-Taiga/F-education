# F Education 予約システム - ページ一覧図

## 1. ユーザーフロー概要

```
                                      +---------------+
                                      |               |
                                      |    認証画面   |
                                      |  (auth-page)  |
                                      |               |
                                      +-------+-------+
                                              |
                                              | ログイン成功
                                              v
                              +---------------+---------------+
                              |                               |
                              |           ホーム画面          |
                              |        (home-page)           |
                              |                               |
                              +-------------------------------+
                                              |
                                              | ユーザー種別に応じた表示
                                              |
          +-----------------------------+-----+-----+-----------------------------+
          |                             |             |                           |
     +----v----+                   +----v----+   +----v----+                +----v----+
     |         |                   |         |   |         |                |         |
     | 生徒向け |                   | 保護者向け|   | 講師向け |                |  管理者  |
     |  画面   |                   |  画面   |   |  画面   |                |   画面   |
     |         |                   |         |   |         |                |         |
     +----+----+                   +----+----+   +----+----+                +----+----+
          |                             |             |                           |
          |                             |             |                           |
          v                             v             v                           v
     +----------+                  +---------+   +---------+                +-----------+
     |・授業予約|                  |・授業予約|   |・スケジュール|            |・ユーザー管理|
     |・レポート閲覧|               |・チケット購入|  |・レポート作成|           |・講師管理  |
     |・個人設定|                  |・生徒管理|   |・プロフィール|            |・システム設定|
     +----------+                  +---------+   +---------+                +-----------+
```

## 2. 詳細ページ一覧

### ユーザー共通ページ

| ページ名 | ファイル | URL | 説明 | 主なボタン・アクション | アクセス条件 |
|---------|---------|-----|------|-------------------|------------|
| 認証画面 | auth-page.tsx | `/auth` | ログイン・新規登録フォーム | ログイン、会員登録 | 未認証ユーザー |
| ホーム画面 | home-page.tsx | `/` | ダッシュボード、予約一覧 | 予約する、チケット購入、各種機能メニュー | 認証済みユーザー |
| 設定画面 | settings-page.tsx | `/settings` | ユーザー設定、プロフィール編集 | 保存、キャンセル、生徒追加 | 認証済みユーザー |
| プロフィール設定 | profile-setup-page.tsx | `/profile-setup` | 初回ログイン時のプロフィール設定 | 保存して続ける | 認証済み新規ユーザー |
| チケット購入 | ticket-purchase-page.tsx | `/tickets` | 授業チケットの購入（PayPal連携） | 購入数選択、PayPalで支払う | 認証済みユーザー（保護者） |
| 授業予約 | booking-page.tsx | `/booking` | 授業の予約・時間選択 | 日付選択、時間選択、講師選択、予約確定 | 認証済みユーザー（生徒/保護者） |
| レポート一覧 | report-list-page.tsx | `/reports` | 授業レポートの閲覧 | レポート詳細表示、フィルター | 認証済みユーザー |
| 404ページ | not-found.tsx | `*` | 存在しないページへのアクセス時 | ホームに戻る | すべてのユーザー |

### 講師専用ページ

| ページ名 | ファイル | URL | 説明 | 主なボタン・アクション | アクセス条件 |
|---------|---------|-----|------|-------------------|------------|
| 講師プロフィール | tutor-profile-page.tsx | `/tutor/profile` | 講師プロフィール管理 | 編集、保存、キャンセル | 認証済み講師 |
| 講師スケジュール | tutor-schedule-page.tsx | `/tutor/schedule` | 講師の授業スケジュール管理 | シフト追加、シフト編集、シフト削除 | 認証済み講師 |
| 講師予約管理 | tutor-bookings-page.tsx | `/tutor/bookings` | 講師の予約一覧表示 | 予約詳細、レポート作成、フィルター | 認証済み講師 |
| レポート編集 | report-edit-page.tsx | `/report-edit` | 授業レポートの作成・編集 | 保存、下書き保存、キャンセル | 認証済み講師 |

### その他/開発ページ

| ページ名 | ファイル | URL | 説明 | 主なボタン・アクション | アクセス条件 |
|---------|---------|-----|------|-------------------|------------|
| デバッグページ | debug-page.tsx | `/debug` | 開発用デバッグページ | 各種テスト機能 | なし（開発環境のみ） |

## 3. コンポーネント構造

主要なコンポーネントと、それらがどのページで使用されているかを示します：

### 予約関連コンポーネント

| コンポーネント名 | ファイルパス | 主な機能 | 使用されているページ |
|--------------|-----------|---------|-----------------|
| カレンダービュー | `client/src/components/calendar-view.tsx` | 予約カレンダーの表示、日付選択、予約の色分け表示 | ホーム画面、授業予約画面、講師スケジュール画面 |
| 予約カード | `client/src/components/booking-card.tsx` | 予約の簡易情報表示、詳細リンク | ホーム画面 |
| 予約確認モーダル | `client/src/components/booking-confirmation-modal.tsx` | 予約内容の確認と確定 | 授業予約画面 |
| 予約詳細モーダル | `client/src/components/booking-detail-modal.tsx` | 予約の詳細情報表示、キャンセル機能 | ホーム画面、講師予約画面 |

### レポート関連コンポーネント

| コンポーネント名 | ファイルパス | 主な機能 | 使用されているページ |
|--------------|-----------|---------|-----------------|
| レポート閲覧モーダル | `client/src/components/report-view-modal.tsx` | 授業レポートの閲覧表示 | ホーム画面、レポート一覧画面 |
| レポート編集モーダル | `client/src/components/report-edit-modal.tsx` | 授業レポートの作成・編集機能 | 講師予約画面、レポート編集画面 |
| レポートカード | `client/src/components/report-card.tsx` | レポートの簡易情報表示、詳細リンク | レポート一覧画面 |

### 決済関連コンポーネント

| コンポーネント名 | ファイルパス | 主な機能 | 使用されているページ |
|--------------|-----------|---------|-----------------|
| PayPalボタン | `client/src/components/PayPalButton.tsx` | PayPalを通じた決済処理 | チケット購入画面 |
| 数量選択 | `client/src/components/ticket-quantity-selector.tsx` | チケット購入数の選択 | チケット購入画面 |
| 支払い確認モーダル | `client/src/components/payment-confirmation-modal.tsx` | 支払い内容の確認 | チケット購入画面 |

### 共通UIコンポーネント

| コンポーネント名 | ファイルパス | 主な機能 | 使用されているページ |
|--------------|-----------|---------|-----------------|
| ヘッダー | `client/src/components/header.tsx` | サイト共通ヘッダー、ナビゲーション | すべてのページ |
| サイドバー | `client/src/components/sidebar.tsx` | 機能メニューのサイドバー | 認証済みページ共通 |
| ユーザーメニュー | `client/src/components/user-menu.tsx` | ユーザー関連のドロップダウンメニュー | 認証済みページ共通 |

## 4. ユーザーロール別アクセス可能ページ

### 未認証ユーザー

| ページ名 | URL | 主な操作 |
|---------|-----|---------|
| 認証画面 | `/auth` | ログイン、新規登録 |
| 404ページ | 定義外のURL | ホームに戻る |

### 認証済み生徒ユーザー

| ページ名 | URL | 主な操作 | メニュー位置 |
|---------|-----|---------|------------|
| ホーム画面 | `/` | 予約確認、レポート閲覧 | ヘッダーロゴ |
| 授業予約画面 | `/booking` | 授業予約、講師選択 | メインメニュー |
| 設定画面 | `/settings` | プロフィール編集 | ヘッダーメニュー |
| レポート一覧 | `/reports` | 過去のレポート閲覧 | メインメニュー |

### 認証済み保護者ユーザー

| ページ名 | URL | 主な操作 | メニュー位置 |
|---------|-----|---------|------------|
| ホーム画面 | `/` | 予約確認、生徒管理 | ヘッダーロゴ |
| 授業予約画面 | `/booking` | 授業予約、講師選択 | メインメニュー |
| チケット購入画面 | `/tickets` | チケット購入、支払い | メインメニュー |
| 設定画面 | `/settings` | プロフィール編集、生徒追加 | ヘッダーメニュー |
| レポート一覧 | `/reports` | 過去のレポート閲覧、フィルタリング | メインメニュー |

### 認証済み講師ユーザー

| ページ名 | URL | 主な操作 | メニュー位置 |
|---------|-----|---------|------------|
| ホーム画面 | `/` | 予約確認、予定表示 | ヘッダーロゴ |
| 講師プロフィール | `/tutor/profile` | プロフィール編集、指導科目管理 | メインメニュー |
| 講師スケジュール | `/tutor/schedule` | シフト追加、シフト管理 | メインメニュー |
| 講師予約管理 | `/tutor/bookings` | 予約確認、レポート作成 | メインメニュー |
| レポート編集 | `/report-edit` | レポート作成、編集 | リダイレクト（直接アクセスなし） |
| 設定画面 | `/settings` | アカウント設定 | ヘッダーメニュー |

### 認証済み管理者ユーザー（将来実装予定）

| ページ名 | URL | 主な操作 | メニュー位置 |
|---------|-----|---------|------------|
| 管理者ダッシュボード | `/admin` | 統計表示、管理機能アクセス | ヘッダーメニュー |
| ユーザー管理 | `/admin/users` | ユーザー検索、編集、追加 | 管理メニュー |
| 講師管理 | `/admin/tutors` | 講師検索、編集、追加 | 管理メニュー |
| 予約管理 | `/admin/bookings` | 予約検索、編集、キャンセル | 管理メニュー |
| チケット管理 | `/admin/tickets` | チケット付与、履歴確認 | 管理メニュー |

## 5. 認証と保護されたルート

アプリケーションはProtectedRouteコンポーネントを使用して、未認証ユーザーがアクセスできないページを保護しています。

```tsx
<ProtectedRoute path="/" component={HomePage} />
```

このコンポーネントは以下の動作をします：
1. ユーザーの認証状態を確認
2. 認証されていない場合は `/auth` にリダイレクト
3. 認証されている場合は要求されたコンポーネントを表示

未認証ユーザーは `/auth` 画面のみアクセス可能です。

## 6. 詳細ページ遷移図

### 6.1 生徒ユーザー画面遷移図

```
+---------------+    「予約する」ボタン    +---------------+
|               |--------------------->|               |
|   ホーム画面   |                       |   授業予約画面  |
|  (home-page)  |<---------------------|  (booking-page)|
|               |    「戻る」ボタン       |               |
+-------+-------+                       +-------+-------+
        |                                       |
        | カレンダー                             | 「予約確定」ボタン
        | 予約クリック                           |
        v                                       v
+---------------+                       +---------------+
|               |                       |               |
| レポート閲覧   |                       |   予約確認    |
|  モーダル     |                       |   モーダル    |
|               |                       |               |
+-------+-------+                       +---------------+
        |                                       |
        | 「閉じる」                             | 「確定」
        |                                       |
        v                                       v
      ホーム画面                               ホーム画面
    （更新表示）                            （予約追加表示）
```

### 6.2 保護者ユーザー画面遷移図

```
                           +---------------+
                           |               |
                           |   設定画面    |
                           | (settings-page)|
                           |               |
                           +-------+-------+
                                   ^
                                   |
          +------------------------|
          |                        | 「設定」
+---------+---------+    「予約」  +---------------+    「チケット購入」  +---------------+
|                   |------------>|               |------------------>|               |
|     ホーム画面     |             |   授業予約画面  |                   | チケット購入画面 |
|    (home-page)    |<------------|  (booking-page)|                   |(ticket-purchase)|
|                   |    「戻る」   |               |<------------------|               |
+---------+---------+             +---------------+    「戻る」         +---------------+
          |                               |                                    |
          | 生徒選択                       | 「予約確定」                         | 「購入」
          | カレンダー                     |                                    |
          v                               v                                    v
   +-------------+               +---------------+                     +---------------+
   | 生徒管理     |               |               |                     |               |
   | モーダル     |               |   予約確認    |                     |   PayPal決済  |
   |             |               |   モーダル    |                     |   処理        |
   +-------------+               +---------------+                     +---------------+
```

### 6.3 講師ユーザー画面遷移図

```
+---------------+     「プロフィール」     +---------------+
|               |--------------------->|               |
|               |                      | 講師プロフィール |
|               |<---------------------|               |
|               |      「戻る」         +---------------+
|               |
|               |      「スケジュール」    +---------------+
|               |--------------------->|               |
|    ホーム画面   |                      | 講師スケジュール |
|  (home-page)   |<---------------------|               |
|               |       「戻る」        +-------+-------+
|               |                              |
|               |                              | 「シフト追加」
|               |                              v
|               |                      +---------------+
|               |                      |               |
|               |                      |  シフト編集   |
|               |                      |  モーダル    |
+-------+-------+                      +---------------+
        |
        | 予約クリック
        v
+---------------+     「レポート作成」     +---------------+
|               |--------------------->|               |
|  予約詳細     |                      |  レポート編集  |
|  モーダル     |<---------------------|  (report-edit) |
|               |       「完了」        |               |
+---------------+                      +---------------+
```

### 6.4 ホーム画面のボタンと遷移先

| ユーザー種別 | ボタン/リンク | 遷移先 |
|-------------|-------------|-------|
| 全ユーザー共通 | ヘッダーロゴ | ホーム画面 (`/`) |
| 全ユーザー共通 | 設定アイコン | 設定画面 (`/settings`) |
| 全ユーザー共通 | ログアウト | 認証画面 (`/auth`) |
| 生徒/保護者 | 「予約する」ボタン | 授業予約画面 (`/booking`) |
| 保護者 | 「チケット購入」ボタン | チケット購入画面 (`/tickets`) |
| 講師 | 「スケジュール管理」ボタン | 講師スケジュール画面 (`/tutor/schedule`) |
| 講師 | 「プロフィール」リンク | 講師プロフィール画面 (`/tutor/profile`) |

### 6.5 主要画面のモーダルウィンドウ

| 画面 | モーダル | 機能 | コンポーネント |
|-----|---------|------|--------------|
| ホーム画面 | 予約詳細モーダル | 予約の詳細表示、キャンセル機能 | `booking-detail-modal.tsx` |
| ホーム画面 | レポート閲覧モーダル | 授業レポートの閲覧 | `report-view-modal.tsx` |
| 授業予約画面 | 予約確認モーダル | 予約内容の最終確認 | `booking-confirmation-modal.tsx` |
| 講師スケジュール画面 | シフト追加モーダル | 講師の授業可能時間帯設定 | `shift-edit-modal.tsx` |
| 講師予約画面 | レポート編集モーダル | 授業レポートの作成・編集 | `report-edit-modal.tsx` |

### 6.6 モーダルの連携と状態管理

実装例: レポート閲覧モーダルからレポート編集モーダルへの遷移

```jsx
{/* レポート表示モーダル */}
{selectedBooking && (
  <ReportViewModal
    isOpen={showReportViewModal}
    booking={{
      id: selectedBooking.id,
      // その他の予約情報...
      reportStatus: selectedBooking.reportStatus || null,
      reportContent: selectedBooking.reportContent || null,
      // 追加情報
      studentName: selectedBooking.studentName || getStudentName(selectedBooking.studentId),
      tutorName: tutorProfile?.lastName + " " + tutorProfile?.firstName,
    }}
    onClose={() => setShowReportViewModal(false)}
    onEdit={() => {
      // 確実にレポート表示モーダルを閉じる
      setShowReportViewModal(false);
      
      // 編集モーダルを表示（タイミング調整のため少し遅延）
      setTimeout(() => {
        openReportEditModalFn(selectedBooking);
      }, 300);
    }}
  />
)}

{/* レポート編集モーダル */}
{showReportEditModal && reportEditBooking && (
  <ReportEditModal
    isOpen={showReportEditModal}
    booking={{
      // 予約情報...
      reportStatus: reportEditBooking.reportStatus || null,
      reportContent: reportEditBooking.reportContent || "",
    }}
    onClose={() => {
      setShowReportEditModal(false);
      setReportEditBooking(null);
    }}
    onSuccess={() => {
      // レポート編集成功時の処理
    }}
  />
)}
```

各ページには共通のナビゲーションメニューが表示され、ユーザーはアクセス可能なページ間を自由に移動できます。

## 7. 画面レイアウトとレスポンシブデザイン

アプリケーションは、PC/デスクトップとモバイル端末の両方に最適化されたレスポンシブデザインを採用しています。主要な画面では以下のようなレイアウト調整が行われています：

### 7.1 ホーム画面（カレンダービュー）

| 表示デバイス | セル高さ | 1日あたりの表示予約数 | その他の調整 |
|------------|--------|-------------------|------------|
| PC/デスクトップ | 180px | 3件まで | 右側に凡例表示、予約詳細をカード形式で表示 |
| タブレット | 140px | 2-3件 | カレンダーサイズを画面幅に合わせて調整 |
| モバイル | 100px | 2件まで | 凡例を上部に表示、予約をコンパクト表示 |

### 7.2 予約画面の最適化

- PC/デスクトップ：科目選択と日付選択を横に並べて表示
- モバイル：科目選択と日付選択を縦に配置し、自動スクロール機能で時間選択部分に誘導

### 7.3 レスポンシブ対応の実装方法

- Tailwind CSSのブレークポイント（sm、md、lg、xl）を活用
- FlexboxとGridレイアウトを組み合わせた柔軟なレイアウト
- ビューポート高さの動的調整（モバイルブラウザのアドレスバー対応）

```jsx
// ビューポート高さの動的調整例（App.tsxより）
useEffect(() => {
  const setVhProperty = () => {
    const vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
  };

  // 初期設定とリサイズイベントリスナー
  setVhProperty();
  window.addEventListener('resize', setVhProperty);
  
  return () => {
    window.removeEventListener('resize', setVhProperty);
  };
}, []);
```